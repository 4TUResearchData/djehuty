{% extends "prefixes.sparql" %}
{% block query %}
DELETE {
  GRAPH <{{state_graph}}> {
    {%- if title is not none %}
    ?dataset           djht:title                ?title .
    {%- endif%}{% if description is not none %}
    ?dataset           djht:description          ?description .
    {%- endif%}{% if resource_doi is not none %}
    ?dataset           djht:resource_doi         ?resource_doi .
    {%- endif%}{% if resource_title is not none %}
    ?dataset           djht:resource_title       ?resource_title .
    {%- endif%}{% if license_id is not none %}
    ?dataset           djht:license              ?license .
    {%- endif%}{% if group_id is not none %}
    ?dataset           djht:group_id             ?group_id .
    {%- endif%}{% if time_coverage is not none %}
    ?dataset           djht:time_coverage        ?time_coverage .
    {%- endif%}{% if publisher is not none %}
    ?dataset           djht:publisher            ?publisher .
    {%- endif%}{% if language is not none %}
    ?dataset           djht:language             ?language .
    {%- endif%}{% if format is not none %}
    ?dataset           djht:format               ?format .
    {%- endif%}{% if contributors is not none %}
    ?dataset           djht:contributors         ?contributors .
    {%- endif%}{% if license_remarks is not none %}
    ?dataset           djht:license_remarks      ?license_remarks .
    {%- endif%}{% if geolocation is not none %}
    ?dataset           djht:geolocation          ?geolocation .
    {%- endif%}{% if longitude is not none %}
    ?dataset           djht:longitude            ?longitude .
    {%- endif%}{% if latitude is not none %}
    ?dataset           djht:latitude             ?latitude .
    {%- endif%}{% if data_link is not none %}
    ?dataset           djht:data_link            ?data_link .
    {%- endif%}{% if derived_from is not none %}
    ?dataset           djht:derived_from         ?derived_from .
    {%- endif%}{% if same_as is not none %}
    ?dataset           djht:same_as              ?same_as .
    {%- endif%}{% if organizations is not none %}
    ?dataset           djht:organizations        ?organizations .
    {%- endif%}{% if defined_type_name is not none %}
    ?dataset           djht:defined_type_name    ?defined_type_name .
    {%- endif%}{% if defined_type is not none %}
    ?dataset           djht:defined_type         ?defined_type .
    {%- endif%}{% if has_linked_file is not none %}
    ?dataset           djht:has_linked_file      ?has_linked_file .
    {%- endif%}{% if embargo_until_date is not none or not is_embargoed %}
    ?dataset           djht:embargo_until_date   ?embargo_until_date .
    {%- endif%}{% if embargo_type is not none or not is_embargoed %}
    ?dataset           djht:embargo_type         ?embargo_type .
    {%- endif%}{% if embargo_title is not none or not is_embargoed %}
    ?dataset           djht:embargo_title        ?embargo_title .
    {%- endif%}{% if embargo_reason is not none or not is_embargoed %}
    ?dataset           djht:embargo_reason       ?embargo_reason .
    {%- endif%}{% if embargo_allow_access_requests is not none or not is_embargoed %}
    ?dataset  djht:embargo_allow_access_requests ?embargo_allow_access_requests .
    {%- endif%}
    ?dataset           djht:modified_date        ?modified_date .
  }
}
INSERT {
  GRAPH <{{state_graph}}> {
    {%- if title is not none %}
    ?dataset           djht:title                {{title}} .
    {%- endif%}{% if description is not none %}
    ?dataset           djht:description          {{description}} .
    {%- endif%}{% if resource_doi is not none %}
    ?dataset           djht:resource_doi         {{resource_doi}} .
    {%- endif%}{% if resource_title is not none %}
    ?dataset           djht:resource_title       {{resource_title}} .
    {%- endif%}{% if license_id is not none %}
    ?dataset           djht:license              ?new_license .
    {%- endif%}{% if group_id is not none %}
    ?dataset           djht:group_id             {{group_id}} .
    {%- endif%}{% if time_coverage is not none %}
    ?dataset           djht:time_coverage        {{time_coverage}} .
    {%- endif%}{% if publisher is not none %}
    ?dataset           djht:publisher            {{publisher}} .
    {%- endif%}{% if language is not none %}
    ?dataset           djht:language             {{language}} .
    {%- endif%}{% if format is not none %}
    ?dataset           djht:format               {{format}} .
    {%- endif%}{% if contributors is not none %}
    ?dataset           djht:contributors         {{contributors}} .
    {%- endif%}{% if license_remarks is not none %}
    ?dataset           djht:license_remarks      {{license_remarks}} .
    {%- endif%}{% if geolocation is not none %}
    ?dataset           djht:geolocation          {{geolocation}} .
    {%- endif%}{% if longitude is not none %}
    ?dataset           djht:longitude            {{longitude}} .
    {%- endif%}{% if latitude is not none %}
    ?dataset           djht:latitude             {{latitude}} .
    {%- endif%}{% if data_link is not none %}
    ?dataset           djht:data_link            {{data_link}} .
    {%- endif%}{% if derived_from is not none %}
    ?dataset           djht:derived_from         {{derived_from}} .
    {%- endif%}{% if same_as is not none %}
    ?dataset           djht:same_as              {{same_as}} .
    {%- endif%}{% if organizations is not none %}
    ?dataset           djht:organizations        {{organizations}} .
    {%- endif%}{% if defined_type_name is not none %}
    ?dataset           djht:defined_type_name    {{defined_type_name}} .
    {%- endif%}{% if defined_type is not none %}
    ?dataset           djht:defined_type         {{defined_type}} .
    {%- endif%}{% if has_linked_file is not none %}
    ?dataset           djht:has_linked_file      {{has_linked_file}} .
    {%- endif%}{% if embargo_until_date is not none %}
    ?dataset           djht:embargo_until_date   {{embargo_until_date}} .
    {%- endif%}{% if embargo_type is not none %}
    ?dataset           djht:embargo_type         {{embargo_type}} .
    {%- endif%}{% if embargo_title is not none %}
    ?dataset           djht:embargo_title        {{embargo_title}} .
    {%- endif%}{% if embargo_reason is not none %}
    ?dataset           djht:embargo_reason       {{embargo_reason}} .
    {%- endif%}{% if embargo_allow_access_requests is not none %}
    ?dataset  djht:embargo_allow_access_requests {{embargo_allow_access_requests}} .
    {%- endif%}
    ?dataset           djht:modified_date        "{{modified_date}}"^^xsd:dateTime .
  }
}
WHERE {
  GRAPH <{{state_graph}}> {
    ?container          rdf:type                 djht:DatasetContainer .
    ?container          djht:account_id           ?account_id .
    ?container          djht:draft                ?dataset .

    ?dataset            rdf:type                 djht:Dataset .
    ?dataset            djht:title                ?title .

    {%- if license_id is not none %}
    ?new_license        rdf:type                 djht:License ;
                        djht:id                   {{license_id}} .
    {%- endif%}

    OPTIONAL { ?dataset djht:license              ?license . }
    OPTIONAL { ?dataset djht:description          ?description . }
    OPTIONAL { ?dataset djht:group_id             ?group_id . }
    OPTIONAL { ?dataset djht:resource_doi         ?resource_doi . }
    OPTIONAL { ?dataset djht:resource_title       ?resource_title . }
    OPTIONAL { ?dataset djht:modified_date        ?modified_date . }
    OPTIONAL { ?dataset djht:publisher             ?publisher . }
    OPTIONAL { ?dataset djht:language              ?language . }
    OPTIONAL { ?dataset djht:time_coverage         ?time_coverage . }
    OPTIONAL { ?dataset djht:geolocation           ?geolocation . }
    OPTIONAL { ?dataset djht:longitude             ?longitude . }
    OPTIONAL { ?dataset djht:latitude              ?latitude . }
    OPTIONAL { ?dataset djht:format                ?format . }
    OPTIONAL { ?dataset djht:organizations         ?organizations . }
    OPTIONAL { ?dataset djht:data_link             ?data_link . }
    OPTIONAL { ?dataset djht:same_as               ?same_as . }
    OPTIONAL { ?dataset djht:derived_from          ?derived_from . }
    OPTIONAL { ?dataset djht:contributors          ?contributors . }
    OPTIONAL { ?dataset djht:license_remarks       ?license_remarks . }
    OPTIONAL { ?dataset djht:defined_type_name     ?defined_type_name . }
    OPTIONAL { ?dataset djht:defined_type          ?defined_type . }
    OPTIONAL { ?dataset djht:has_linked_file       ?has_linked_file . }
    OPTIONAL { ?dataset djht:embargo_until_date    ?embargo_until_date . }
    OPTIONAL { ?dataset djht:embargo_type          ?embargo_type . }
    OPTIONAL { ?dataset djht:embargo_title         ?embargo_title . }
    OPTIONAL { ?dataset djht:embargo_reason        ?embargo_reason . }
    OPTIONAL { ?dataset djht:embargo_allow_access_requests ?embargo_allow_access_requests . }
  }
{%- if account_id is not none: %}
  FILTER (?account_id = {{account_id}})
{%- endif %}
  FILTER (?container = <{{container_uri}}>)
}
{% endblock %}
