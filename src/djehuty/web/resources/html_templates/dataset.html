{% extends "layout.html" %}
{% block headers %}
{# TODO:
   file previews (for which file types?)
   versioned and unversioned doi on latest version, explained #}
<script src="/static/js/jquery-3.6.0.min.js"></script>
<script src="/static/js/dataset_landing_page.js"></script>
<link rel="stylesheet" type="text/css" href="/static/css/pub.css" />
{% endblock %}

{% block body %}
{% set doi = item.doi %}
{% set pid = item.dataset_id %}
{% set uuid = item.container_uuid %}
{% set item_type = "dataset" %}

{% include 'public_metadata.html' %}

<div id="data">

    <h3>DATA</h3>
{% if item.is_embargoed %}
  {# TODO: item.embargo_allow_access_requests:
           - add link
           - only for embargoes or also for other restricted access?
     item.embargo_title: Needed? it usually says "File(s) under embargo".
     item.embargo_type will always be "file" here, but what happens with item.embargo_type "article"?
  #}
        <div id="embargo_notice">
            <p>The files in this dataset are under embargo{% if item.embargo_until_date %} until {{item.embargo_until_date}}{% endif %}.</p>
    {% if embargo_allow_access_requests %}
            <a href="#">request access</a> {# not yet clear where the link should go #}
    {% endif %}
        </div>
{% elif item.is_metadata_record %}
{# test 18586031 #}
        <div id="metadata_only">
    {% if item.metadata_reason %}
            {{item.metadata_reason}}
    {% else %}
            Data is undisclosed.
    {% endif %}
        </div>
{% elif item.is_confidential %}
{# test 12999575 #}
        <div id="confidential">
    {% if item.confidential_reason %}
            {{item.confidential_reason}}
    {% else %}
            Data is confidential.
    {% endif %}
        </div>
{% else %}
{% if services %}
{# test 12717890 #}
    <div id="services">
        <div class="label">data service</div>
        <ul>
    {% for url in services %}
            <li><a href="{{url}}" target="_blank" title="opens in new window">{{url}}</a></li>
    {% endfor %}
        </ul>
    </div>
{% endif%}
{% if opendap %}
{# test 17122553 #}
    <div id="opendap">
        <div class="label">OPeNDAP data service</div>
        <ul>
    {% for url in opendap %}
            <li>
                <a href="{{url}}" target="_blank" title="opens in new window">{{url}}</a>
                [<a href="{{url|replace('.html','.xml')}}" target="_blank">xml</a>]
            </li>
    {% endfor %}
        </ul>
    </div>
{% endif%}
{%- if git_repository_url %}
    <div id="git-repository">
      <p>To access the source code, use the following command:</p>
      <pre>git clone {{git_repository_url}}</pre>
    </div>
{%- endif %}
{% if files %}
{# test 16545714 #}
    <div id="files">
        <div class="label">files</div>
        <ul>
    {% for file in files %}
            <li>
                <span class="size">{{'{:,}'.format(file.size)}} bytes</span>
                <a href="{{file.download_url}}" title="md5: {{file.computed_md5}}">{{file.name}}</a>
            </li>
    {% endfor %}
    {% if files|length > 1 %}
            <li class="zip"><a href="ndownloader/items/{{pid}}/versions/{{item.version}}">download all files (zip)</a></li>
    {% endif %}
        </ul>
    </div>
{% endif %}
{% endif %}
</div>
{%- if not in_production: %}
{% set debug_vars = {"item":item, "version":version, "versions":versions, "citation":citation, "authors":authors, "contributors":contributors,
                     "files":files, "services":services, "tags":tags, "categories":categories, "fundings":fundings,
                     "references": references, "derived_from":derived_from, "collections":collections, "my_collections":my_collections,
                     "dates":dates, "coordinates":coordinates, "id_version":id_version, "opendap":opendap, "statistics":statistics} %}
{% set djehuty_API   = "/v2/articles/"~pid %}
{% set figshare_html = "https://data.4tu.nl/articles/_/"~pid %}
{% set figshare_API = "https://api.figshare.com/v2/articles/"~pid %}
{% if version %}
    {% set djehuty_API   = djehuty_API~"/versions/"~version %}
    {% set figshare_html = figshare_html~"/"~version %}
    {% set figshare_API  = figshare_API~"/versions/"~version %}
{% endif %}
{% include 'debug.html' %}
{%- endif %}
{% endblock %}
