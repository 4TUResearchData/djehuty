{% extends "layout.html" %}
{% block headers %}
<script src="/static/js/jquery-3.6.0.min.js"></script>
<script src="/static/js/quill.min.js"></script>
<script src="/static/js/edit-dataset.js"></script>
<script>
jQuery(document).ready(function (){
    root_categories = []
    jQuery(".hide-for-javascript").removeClass("hide-for-javascript");
    jQuery(".subcategory-wrapper").hide();
{%- for category in categories: %}
    root_categories.push("{{category.uuid}}");
    jQuery("#category_{{category.uuid}}").change(function () {
        if (this.checked) {
            jQuery("#category_{{category.uuid}}").prop("checked", true);
            jQuery("#subcategories_{{category.uuid}}").slideDown(200);
        } else {
            jQuery("#subcategories_{{category.uuid}} input[name='categories']").prop("checked", false);
            jQuery("#subcategories_{{category.uuid}}").slideUp(200);
        }
    });
{%- endfor %}
    activate ("{{container_uuid}}");
});
</script>
<link href="/static/css/quill.4tu.css" rel="stylesheet">
<style>
.upload-wrapper { text-align: center; }
.upload-container {
    display: block;
    width: auto;
    border: 2pt dashed #ccc;
    background: #f9f9f9;
    border-radius: .5em;
    margin: auto auto 1em auto;
    vertical-align: middle;
    text-align: center;
    color: #333;
}
.upload-container:hover { cursor: pointer; }
.upload-container p { font-size: 1.2em; }
#file { display: none; }
.branded-table {
    width: 100%;
    max-width: 880pt;
    border: solid 2pt #ccc;
    border-radius: .5em;
    margin-bottom: 1em;
}
.branded-table thead tr { background: #ccc; border-radius: .5em .5em 0em 0em; }
.branded-table thead tr th { color: #000; text-align: left; padding: .5em; z-index: 50; border-top: none; }
.branded-table thead tr th:last-child { text-align: right; }
.branded-table tbody tr td { padding: .5em; z-index: 50; }
.branded-table tbody tr:nth-child(even) { background: #fafafa; }
.branded-table tbody tr td:last-child { text-align: right; width: 130pt; }
.branded-table tbody tr td:nth-child(1) {
    text-overflow: ellipsis;
    overflow: hidden;
    white-space: nowrap;
    width: 100%;
    max-width: 572pt;
}
.files td { text-align: left; }
#content-wrapper h3:first-child { margin-top: 0em; }
#content-wrapper h3 {
    font-size: 1.75em;
    padding: 0em;
    margin: .75em 0em .75em 0em;
    border-bottom: 4px dotted #f49120;
}
#software_upload_field h4 {
    font-size: 1.25em;
    margin: .75em 0em .25em 0em;
    font-weight: bold;
    border-bottom: 2px dotted #f49120;
}
#content-wrapper input[type="text"],
#content-wrapper input[type="datetime-local"],
#content-wrapper input[type="date"],
#content-wrapper textarea,
.texteditor,
#content-wrapper .options-wrapper, #groups-wrapper, #access-wrapper {
    display: block;
    padding: .7em;
    border: solid 1pt #aaa;
    border-radius: 0em .5em .5em .5em;
    width: 832pt;
    margin-top: 0em;
    margin-bottom: 1em;
    font-size: 13pt;
}
#access-wrapper #access-type-wrapper {
    border: none;
    border-bottom: solid 2pt #333;
    border-radius: 0em;
    width: 812pt !important;
    padding-bottom: 0pt;
}
#access-wrapper #access-type-wrapper label { border-radius: .5em .5em 0em 0em;  }
#access-wrapper input[type="text"],
#access-wrapper input[type="datetime-local"],
#access-wrapper input[type="date"],
#access-wrapper textarea,
#access-wrapper .options-wrapper { width: 812pt !important; }
#access-wrapper select,
#access-wrapper .ql-toolbar.ql-4tu,
#access-wrapper .texteditor { width: 832pt !important; }
#embargoed_access_form { display: none }
#restricted_access_form { display: none; }
#closed_access_form { display: none; }
#content-wrapper select {
    display: block;
    padding: .7em;
    border: solid 1pt #aaa;
    background: #fff;
    border-radius: 0em .5em .5em .5em;
    width: 852pt;
    margin-top: 0em;
    margin-bottom: 1em;
    font-size: 13pt;
}
.texteditor {
    padding: 0em !important;
    border-radius: 0em 0em .5em .5em !important;
    resize: vertical;
    font-size: 1.0em;
    width: 852pt;
}
#content-wrapper label {
    display: inline-block;
    background: #ffeecc;
    color: #000;
    padding: .5em .5em .25em .5em;
    border-radius: .5em .5em 0em 0em;
    font-weight: bold;
}
#content-wrapper label.no-head {
    display: inline-block;
    background: none;
    font-weight: normal;
    cursor: pointer;
}
#content-wrapper label.inner-head {
    display: inline-block;
    background: #eeeeee;
    font-weight: bold;
    cursor: pointer;
}
#content-wrapper textarea:focus,
#content-wrapper input:focus,
#content-wrapper .texteditor:focus {
    outline: none;
    border: solid 1pt #111;
    background: #fffaea;
}
#content-wrapper select:focus {
    outline: none;
    border: solid 1pt #111;
    background: #fffaea;
}
#file-upload h4 { font-size: 1.5em; padding: 0em; margin: .75em 0em .75em 0em; }
.autocomplete {
    border-radius: 0em 0em .5em .5em;
    border: solid 1pt #111;
    width: 850pt;
    margin: 0em 0em 1em 0em;
    padding: 0em;
}
.autocomplete ul { margin: 0em; padding: 0em; }
.autocomplete li { list-style-type: none; margin: 0em; padding: .5em; }
.autocomplete li:nth-child(even) { background: #fafafa; }
.autocomplete li:last-child { border-radius: 0em 0em .5em .5em; }
.input-for-ac {
    border-radius: 0em .5em 0em 0em !important;
    margin-bottom: 0em !important;
    border-bottom: #ddd !important;
    width: 832pt;
}
.list-resource ul { margin: 0em; padding: 0em; }
.list-resource li { list-style-type: none; margin: 0em; padding: .5em; }
#categories-wrapper .subitem-checkbox { margin-left: 3em; }
.subitem-label { cursor: pointer; user-select: none; }
.subitem-label:hover { cursor: pointer; user-select: none; }
.item-label {
    background: none !important;
    border-radius: .5em !important;
    cursor: pointer;
    user-select: none;
}
.multi-list { display: none; border: none; }
.multi-list thead { display: none; }
#new-author { text-align: center; line-height: 3.5em; height: 3.5em; }
#new-funding { text-align: center; line-height: 3.5em; height: 3.5em; }
.a-button a {
    text-decoration: none;
    color: #fff;
    background: #139257;
    border-radius: .5em;
    padding: .5em;
    margin: 1em 0em 1em 0em;
}
.a-button a:hover { background: #18b76d; }
.a-button a:active { background: #107a48; }
#new-author-form { padding: 1em; }
#new-author-form label { background: #eee; }
#new-author-form input[type="text"] { width: 800pt; }
#new-funding-form { padding: 1em; }
#new-funding-form label { background: #eee; }
#new-funding-form input[type="text"] { width: 800pt; }
#references-list { display: none; border: none; }
#references-list thead { display: none; }
#content-wrapper .options-wrapper input[type="radio"] { display: none; }
#content-wrapper .options-wrapper label { padding: .5em; border-radius: .5em; user-select: none; }
#content-wrapper .options-wrapper label:hover { cursor: pointer; background: #eee; }
#content-wrapper .options-wrapper input[type="radio"]:checked+label {
    background: #505050;
    color: #fff;
    border-radius: .5em;
    opacity: 1.0 !important;
}
#content-wrapper .options-wrapper input[type="radio"]:disabled+label { opacity: 0.5; cursor: auto; }
#groups-wrapper h4 {
    padding: .5em;
    margin: .5em 0em 0em 0em;
    font-weight: bold;
    font-size: 1em;
    background: #eee;
    border-radius: .5em;
    user-select: none;
}
#groups-wrapper h4:nth-child(1) { margin: 0em; }
#metadata_reason_field, #external_link_field, #file_upload_field { display: none; }
#git-files { margin: 0em; padding: 0em; }
#git-files li { list-style-type: none; margin: 0em; padding: .5em; }
#git-files li:nth-child(even) { background: #fafafa; }
#embargo_options { display: none; }
</style>
{% endblock %}
{% block submenu %}
<ul>
  <li><a href="/my/datasets">&#8592; Go back</a>
  <li class="active">Edit dataset
  <li class="hide-for-javascript save-button"><a id="save" href="#">Save</a>
  {%- if not article.is_under_review %}
  <li class="hide-for-javascript submit-button"><a id="submit" href="#">Submit for review</a>
  {%- endif %}
  <li class="hide-for-javascript delete-button"><a id="delete" href="#">Delete</a>
</ul>
{% endblock %}
{% block body %}
<div class="article-content">
{%- if article.title == "Untitled item" %}
<h1>Create new dataset</h1>
{%- else %}
<h1>Edit dataset</h1>
{%- endif %}
<noscript>
  <p class="no-script">Sorry, this page requires JavaScript to work correctly.</p>
</noscript>
<div class="hide-for-javascript">
<h2>Dataset details</h2>
<label for="title">Title</label>
<input type="text" id="title" name="title" value="{{article["title"]}}" />
<label>Description</label>
<div id="description" class="texteditor">
  {{article["description"] | default("", True) | replace("\\n", "<br>") | safe }}
</div>
<label>License &#38; Access</label>
<div id="access-wrapper">
  <div id="access-type-wrapper" class="options-wrapper">
<input type="radio" name="access_type" id="open_access" value="open" checked="checked" /><!--
--><label for="open_access" class="no-head">Open access</label><!--
--><input type="radio" name="access_type" id="embargoed_access" value="embargoed" /><!--
--><label for="embargoed_access" class="no-head">Embargoed access</label><!--
--><input type="radio" name="access_type" id="restricted_access" value="restricted" /><!--
--><label for="restricted_access" class="no-head">Restricted access</label><!--
--><input type="radio" name="access_type" id="closed_access" value="closed" /><!--
--><label for="closed_access" class="no-head">Closed access</label>
  </div>
  <div class="access_level" id="open_access_form">
    <p>
      Open access is the default setting in 4TU.ResearchData by which your dataset will be directly accessible to others.
    </p>
    <label for="license_open" class="inner-head">License</label>
    <select id="license_open" class="license-selector" name="license">
      <option value="" disabled selected>Select a license</option>
    </select>
  </div>
  <div class="access_level" id="embargoed_access_form">
    <p>
      Embargo is a period during which a dataset is unavailable and not accessible to anyone else.
      Please enter the end date of the embargo period and add the reason why the files are under embargo.  
    </p>
    <label for="license_embargoed" class="inner-head">License</label>
    <select id="license_embargoed" class="license-selector" name="license">
      <option value="" disabled selected>Select a license</option>
    </select>
    <label for="embargo_until_date" class="inner-head">Until date</label>
    <input id="embargo_until_date" type="date" name="embargo_until_date" value="{{article["embargo_until_date"]}}" />
    <label class="inner-head">Embargo type</label>
    <div id="record-type-wrapper" class="options-wrapper">
      <input type="radio" name="embargo_type" id="files_only_embargo" value="file" /><!--
--><label for="files_only_embargo" class="no-head">Files-only embargo</label>
      <input type="radio" name="embargo_type" id="content_embargo" value="article" /><!--
--><label for="content_embargo" class="no-head">Full content embargo</label></div>
    <label for="title" class="inner-head">Title</label>
    <input type="text" id="embargo_title" name="embargo_title" value="{{article["embargo_title"]}}" />
    <label class="inner-head">Reason</label>
    <div id="embargo_reason" class="texteditor">
      {{article["embargo_reason"] | default("", True) | replace("\\n", "<br>") | safe }}
    </div>
  </div>
  <div class="access_level" id="restricted_access_form">
    <p>
      Restricted access allows you to share your dataset under specific
      conditions and with users who have been granted access. Please specify
      the End-User License Agreement (EULA) in which you specify the
      conditions under which you grant users access to your data files,
      and add the reason why your dataset is restricted.
    </p>
    <label class="inner-head">EULA</label>
    <div id="restricted_access_reason" class="texteditor">
      {{article["embargo_reason"] | default("", True) | replace("\\n", "<br>") | safe }}
    </div>
    <!--
        * Upload box for EULA document.
        * Reason for restricted access field.
      -->
  </div>
  <div class="access_level" id="closed_access_form">
    <p>
      The dataset is inaccessible and there is no process in place to allow others to apply for access to it. We strongly encourage considering publishing as <em>restricted access</em>
      instead. Therefore, please provide a detailed reason for why closed access is applied.
    </p>
    <label class="inner-head">Reason</label>
    <div id="closed_access_reason" class="texteditor">
      {{article["embargo_reason"] | default("", True) | replace("\\n", "<br>") | safe }}
    </div>
  </div>
</div>
<label>Categories</label>
<div id="categories-wrapper" class="options-wrapper">
{%- for root in categories: %}
<input type="checkbox" name="categories" value="{{root.uuid}}" id="category_{{root.uuid}}"><!--
--><label class="item-label" for="category_{{root.uuid}}">{{root.title}}</label><br>
<div id="subcategories_{{root.uuid}}" class="subcategory-wrapper">
{%- for sub in root.subcategories: %}
<input class="subitem-checkbox" type="checkbox" name="categories" value="{{sub.uuid}}" id="category_{{sub.uuid}}"><!--
--><label class="subitem-label no-head" for="category_{{sub.uuid}}">{{sub.title}}</label><br>
{%- endfor %}
</div>
{%- endfor %}
</div>
<h3>Authors</h3>
<label for="authors">Authors</label><input type="text" id="authors" name="authors" />
<table class="branded-table multi-list" id="authors-list">
  <thead>
    <tr><th>Author</th><th>Actions</th></tr>
  </thead>
  <tbody></tbody>
</table>
<label>Group</label>
<div id="groups-wrapper">
{%- for group in groups: %}
<h4>{{group.name}}</h4>
<div id="subgroups_{{group.id}}" class="subgroup-wrapper">
<input class="subitem-checkbox" type="radio" name="groups" value="{{group.id}}" id="group_{{group.id}}" {% if account.group_id == group.id: %}checked="checked"{% endif %}><!--
--><label class="subitem-label no-head" for="group_{{group.id}}">{{group.name}}</label><br>
{%- for sub in group.subgroups: %}
<input class="subitem-checkbox" type="radio" name="groups" value="{{sub.id}}" id="group_{{sub.id}}"><!--
--><label class="subitem-label no-head" for="group_{{sub.id}}">{{sub.name}}</label><br>
{%- endfor %}
</div>
{%- endfor %}
</div>
<label for="publisher">Publisher</label>
<input type="text" id="publisher" name="publisher" value="{{article["publisher"] | default("4TU.ResearchData", True)}}">
<label for="funding">Funding</label><input type="text" id="funding" name="funding" />
<table class="branded-table multi-list" id="funding-list">
  <thead>
    <tr><th>Name</th><th>Actions</th></tr>
  </thead>
  <tbody></tbody>
</table>
<h3>Linked resource &amp; references</h3>
<p>If the dataset is published as part of a scientific paper, add its title and DOI here.</p>
<label for="resource_title">Resource title</label>
<input type="text" id="resource_title" name="resource_title" value="{{article["resource_title"] | default("", True)}}" />
<label for="resource_doi">Resource DOI</label>
<input type="text" id="resource_doi" name="resource_doi" value="{{article["resource_doi"] | default("", True)}}" />
<p>Add any other relevant URLs or DOIs below.</p>
<label for="references">References</label>
<input type="text" id="references" name="references" value="" />
<table class="branded-table" id="references-list">
  <thead>
    <tr><th>Reference</th><th>Actions</th></tr>
  </thead>
  <tbody></tbody>
</table>
<h3>Findability</h3>
<label for="geolocation">Geolocation</label>
<input type="text" id="geolocation" name="geolocation" placeholder="Example: Dam Square, Amsterdam" value="{{article["geolocation"] | default("", True)}}" />
<label for="longitude">Longitude</label>
<input type="text" id="longitude" name="longitude" placeholder="Example: 4.893" value="{{article["longitude"] | default("", True)}}" />
<label for="latitude">Latitude</label>
<input type="text" id="latitude" name="latitude" placeholder="Example: 52.893" value="{{article["latitude"] | default("", True)}}" />
<label for="format">Format</label>
<input type="text" id="format" name="format" placeholder="Example: image/jpeg" value="{{article["format"] | default("", True)}}" />
<label for="data_link">Data Link</label>
<input type="text" id="data_link" name="data_link" placeholder="Link to extra data related to the current item" value="{{article["data_link"] | default("", True)}}" />
<label for="derived_from">Derived From</label>
<input type="text" id="derived_from" name="derived_from" value="{{article["derived_from"] | default("", True)}}" />
<label for="same_as">Same As</label>
<input type="text" id="same_as" name="same_as" value="{{article["same_as"] | default("", True)}}" />
<label for="organizations">Organizations</label>
<textarea id="organizations" name="organizations" placeholder="Example: Delft University of Technology">{{article["organizations"] | default("", True) }}</textarea>
<h3>Files</h3>
<label>Type</label>
<div id="record-type-wrapper" class="options-wrapper">
<input type="radio" name="record_type" id="metadata_record_only" value="meta" /><!--
--><label for="metadata_record_only" class="no-head">Metadata record</label><!--
--><input type="radio" name="record_type" id="external_link" value="link" /><!--
--><label for="external_link" class="no-head">External link</label><!--
--><input type="radio" name="record_type" id="upload_files" value="files" /><!--
--><label for="upload_files" class="no-head">File deposit</label><!--
--><input type="radio" name="record_type" id="upload_software" value="software" /><!--
--><label for="upload_software" class="no-head">Software deposit</label>
</div>
<div id="metadata_reason_field" class="record-type-field">
  <label for="metadata_only_reason">Reason</label>
  <input type="text" name="metadata_only_reason" id="metadata_only_reason" value="{{article["metadata_reason"]}}"/>
</div>
<div id="external_link_field" class="record-type-field">
  <label for="external_link">External URL</label>
  <input type="text" name="external_url" id="external_url" value="{{article["url"]}}" />
  <div class="a-button">
    <a href="#" onclick="javascript:submit_external_link({{article["article_id"]}}); return false;">Save URL</a>
  </div>
</div>
<div id="software_upload_field" class="record-type-field">
  <h4>Publish source code through Git</h4>
  <p>To publish from a Git repository, push a branch to the <code>4tu</code> remote.</p>
  <p>First, add the <code>4tu</code> remote:</p>
  <pre>git remote add 4tu {{base_url}}/v3/datasets/{{article.git_uuid}}.git</pre>
  <p>Then, push the repository to it:</p>
  <pre>
git push 4tu --all
git push 4tu --tags</pre>
  <h4>Repository file tree</h4>
  <ul id="git-files"></ul>
  <div class="center">
    <a id="refresh-git-files" href="#" class="button neutral-button">Refresh repository file list</a>
  </div>
  <h4>Distribution artefacts</h4>
  <p>
    Software packages oftentimes have separate distribution tarballs
    produced by a build system. If applicable, upload them as files below.
  </p>
</div>
<div id="file_upload_field" class="upload-wrapper record-type-field">
  <input type="file" name="file" id="file" aria-label="Upload file">
  <div class="upload-container" id="file-upload">
    <h4>Drag files here</h4>
    <p>Or click to open a file dialog.</p>
  </div>
</div>
<div id="files-wrapper" class="record-type-field">
  <table class="branded-table" id="files">
    <thead>
      <tr><th>Filename</th><th>Checksum</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
</div>
</div>
{% endblock %}
